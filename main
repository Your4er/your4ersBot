import os
from urllib import response
import telebot
from telebot import types
import tempfile
import requests
import json
from PIL import Image
import subprocess
from PIL import ImageGrab

weather_translations = {
    'Thunderstorm': '–ì—Ä–æ–∑–∞',
    'Drizzle': '–ú–æ—Ä–æ—Å—å',
    'Rain': '–î–æ–∂–¥—å',
    'Snow': '–°–Ω–µ–≥',
    'Mist':'–¢—É–º–∞–Ω',
    'Smoke':'–î—ã–º',
    'Haze':'–î—ã–º–∫–∞',
    'Dust':'–ü—ã–ª—å',
    'Fog':'–¢—É–º–∞–Ω',
    'Sand':'–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è',
    'Dust':'–ü—ã–ª—å',
    'Ash':'–ü–µ–ø–µ–ª',
    'Squall':'–®—Ç–æ—Ä–º–æ–≤–æ–π –≤–µ—Ç–µ—Ä',
    'Tornado':'–¢–æ—Ä–Ω–∞–¥–æ',
    'Clear': '–ù–∏ –æ–±–ª–∞—á–∫–∞',
    'Clouds': '–û–±–ª–∞—á–Ω–æ',
    
    
}

# =======================–ê–ø–∏=======================
API_TOKEN = '6731928465:AAHikUIsoLsuCEF6K94dmgB6eiouBGsW90s'
APIKEY = '7f5d868011ad2e1914e219f7b1d8495f'

  
bot = telebot.TeleBot(API_TOKEN)

# =======================–î–æ—Å—Ç—É—Ü–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏=======================
def is_allowed_user(message):
    return message.from_user.username in ['your4er', 'lara_litch'] 

# =======================–ú–µ–Ω—é –∫–Ω–æ–ø–æ–∫=======================     
@bot.message_handler(commands=['start'])
def send_welcome(message):
    if is_allowed_user(message):
        markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
        item1 = types.KeyboardButton('–ü–æ–ª—É—á–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç')
        item2 = types.KeyboardButton('–í—ã–∫–ª—é—á–∏—Ç—å')
        item3 = types.KeyboardButton('–ü–æ–≥–æ–¥–∞')
        item4 = types.KeyboardButton('–ö–æ–µ-—á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å')
        markup.add(item1,item2,item3,item4)
        bot.send_message(message.chat.id, '–î–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫, —á—Ç–æ –∂–µ–ª–∞–µ—Ç–µ?', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

# =======================–°–∫—Ä–∏–Ω=======================
@bot.message_handler(regexp='–ü–æ–ª—É—á–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç')
def echo_message(message):
    if is_allowed_user(message):
        path = tempfile.gettempdir() + 'screenshot.png'
        screenshot = ImageGrab.grab()
        screenshot.save(path, 'PNG')
        bot.send_photo(message.chat.id, open(path, 'rb'))
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

# =======================–ü–æ–≥–æ–¥–∞=======================
@bot.message_handler(regexp='–ü–æ–≥–æ–¥–∞')
def echo_message(message):
    if is_allowed_user(message):
        try:
            resss = requests.get(
                f'https://api.openweathermap.org/data/2.5/weather?q=Nizhniy Novgorod&lang=ru&appid={APIKEY}&units=metric',
                timeout=10 
            )
            resss.raise_for_status()  

            data = json.loads(resss.text)
            weather_desc = data['weather'][0]['description']
            weather_main = data['weather'][0]['main']
            weathermain_translated = weather_translations.get(weather_main, weather_main)
            weather_emoji = data['weather'][0]['id']

            if data['weather'][0]['id'] == 800:  # –ß–∏—Å—Ç–æ–µ –Ω–µ–±–æ
                weather_emoji = '‚òÄÔ∏è'
            elif data['weather'][0]['id'] in range(801, 804):  
                weather_emoji = '‚òÅÔ∏è'
            elif data['weather'][0]['id'] == 200: # –ì—Ä–æ–∑–∞
                weather_emoji = 'üå©'
            elif data['weather'][0]['id'] in range(201, 202):
                weather_emoji = '‚õà'
            elif data['weather'][0]['id'] in range(210, 232):
                weather_emoji = 'üå©'
            elif data['weather'][0]['id'] in range(300, 321): #–ú–æ—Ä–æ—Å—å
                weather_emoji = '‚òîÔ∏è'
            elif data['weather'][0]['id'] in range(500, 511): #–î–æ–∂–¥—å
                weather_emoji = 'üåßÔ∏è'
            elif data['weather'][0]['id'] == 520:
                weather_emoji = 'üå¶'
            elif data['weather'][0]['id'] in range(521, 531):
                weather_emoji = 'üåßÔ∏è'
            elif data['weather'][0]['id'] in range(600, 601): #–°–Ω–µ–≥
                weather_emoji = 'üå®'
            elif data['weather'][0]['id'] == 602:
                weather_emoji = 'üå®'
            elif data['weather'][0]['id'] in range(611, 622):
                weather_emoji = 'üå®'
            elif data['weather'][0]['id'] in range(700, 780): #–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞
                weather_emoji = 'üå´Ô∏è'
            elif data['weather'][0]['id'] == 781: #–¢–æ—Ä–Ω–∞–¥–æ
                weather_emoji = 'üå™'
            else:
                weather_emoji = 'üåà'

            bot.reply_to(message, f'–ü–æ–≥–æ–¥–∞ –≤ –≥–æ—Ä–æ–¥–µ <b>{data["name"]}</b>: <u>{round(data["main"]["temp"])}</u> c¬∫. \n–ß—É–≤—Å—Ç–≤—É–µ—Ç—Å—è –∫–∞–∫: <u>{round(data["main"]["feels_like"])}</u> c¬∫ . \n–ü–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è: <u> {weathermain_translated}{weather_emoji}</u> , <u> {weather_desc}</u>. ', parse_mode='HTML')

        except requests.exceptions.Timeout:
            bot.reply_to(message, "OpenWeather –æ–±–æ—Å—Ä–∞–≤—Å—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.")
        except requests.exceptions.RequestException as e:
            bot.reply_to(message, f"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: {e}")
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')
# =======================–û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤=======================
@bot.message_handler(regexp='–ö–æ–µ-—á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å')
def echo_message(message):
    if is_allowed_user(message):
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        item1 = types.KeyboardButton('–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏')
        item2 = types.KeyboardButton('–û—Ç–∫—Ä—ã—Ç—å –•—Ä–æ–º')
        item3 = types.KeyboardButton('–û—Ç–∫—Ä—ã—Ç—å –Ø–¥—ã–∫—Å')
        item4 = types.KeyboardButton('–û—Ç–∫—Ä—ã—Ç—å –∏–≥–æ—Ä—É –†–∞–¥—É–≥–∞')
        back = types.KeyboardButton('–ù–∞–∑–∞–¥')
        markup.add(item1,item2,item3,item4,back)
        bot.send_message(message.chat.id, '–í—ã–±–∏—Ä–∞–π —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å–∏')
def turn_off(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–û—Ç–∫—Ä—ã–≤–∞—é..')
        file_path = "D:\\Gamez\\CHDNotes.docx"
        subprocess.Popen(['start', file_path], shell=True)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–û—Ç–∫—Ä—ã—Ç—å –•—Ä–æ–º')
def turn_off(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–û—Ç–∫—Ä—ã–≤–∞—é..')
        file_path = "D:\\Gamez\\Chrome.lnk"
        os.startfile(file_path)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–û—Ç–∫—Ä—ã—Ç—å –Ø–¥—ã–∫—Å')
def turn_off(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–û—Ç–∫—Ä—ã–≤–∞—é..')
        file_path = "D:\\Gamez\\Yandex.lnk"
        os.startfile(file_path)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–û—Ç–∫—Ä—ã—Ç—å –∏–≥–æ—Ä—É –†–∞–¥—É–≥–∞')
def turn_off(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–û—Ç–∫—Ä—ã–≤–∞—é..')
        file_path = "D:\\Gamez\\Tom Clancy's Rainbow Six Siege.url"
        os.startfile(file_path)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

# =======================–í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ=======================
@bot.message_handler(regexp='–ù–∞–∑–∞–¥')
def send_welcome(message):
    if is_allowed_user(message):
        markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
        item1 = types.KeyboardButton('–ü–æ–ª—É—á–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç')
        item2 = types.KeyboardButton('–í—ã–∫–ª—é—á–∏—Ç—å')
        item3 = types.KeyboardButton('–ü–æ–≥–æ–¥–∞')
        item4 = types.KeyboardButton('–ö–æ–µ-—á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å')
        markup.add(item1,item2,item3,item4)
        bot.send_message(message.chat.id, '–î–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫, —á—Ç–æ –∂–µ–ª–∞–µ—Ç–µ?', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')
# =======================–í—ã–∫–ª—é—á–µ–Ω–∏–µ=======================
@bot.message_handler(regexp='–í—ã–∫–ª—é—á–∏—Ç—å')
def echo_message(message):
    if is_allowed_user(message):
        markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
        item1 = types.KeyboardButton('–î–∞, –º–æ–∂–Ω–æ')
        item2 = types.KeyboardButton('–¢–∞–π–º–µ—Ä')
        item3 = types.KeyboardButton('–ù–µ –Ω–∞–¥–æ')
        markup.add(item1,item2,item3)
        bot.send_message(message.chat.id, '–í—ã —É–≤–µ—Ä–µ–Ω—ã?', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–ù–µ –Ω–∞–¥–æ')
def send_welcome(message):
    if is_allowed_user(message):
        markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
        item1 = types.KeyboardButton('–ü–æ–ª—É—á–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç')
        item2 = types.KeyboardButton('–í—ã–∫–ª—é—á–∏—Ç—å')
        item3 = types.KeyboardButton('–ü–æ–≥–æ–¥–∞')
        item4 = types.KeyboardButton('–ö–æ–µ-—á—Ç–æ –æ—Ç–∫—Ä—ã—Ç—å')
        markup.add(item1,item2,item3,item4)
        bot.send_message(message.chat.id, '–î–æ–±—Ä–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫, —á—Ç–æ –∂–µ–ª–∞–µ—Ç–µ?', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–î–∞, –º–æ–∂–Ω–æ')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–í—ã–∫–ª—é—á–∞—é...')
        os.system("shutdown -s -t 0")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

# =======================–°–∞–º —Ç–∞–π–º–µ—Ä=======================
@bot.message_handler(regexp='–¢–∞–π–º–µ—Ä')
def send_welcome(message):
    if is_allowed_user(message):
        markup = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True)
        item1 = types.KeyboardButton('15_–º–∏–Ω')
        item2 = types.KeyboardButton('30_–º–∏–Ω')
        item3 = types.KeyboardButton('45_–º–∏–Ω')
        item4 = types.KeyboardButton('60_–º–∏–Ω')
        item5 = types.KeyboardButton('2_—á–∞—Å–∞')
        item6 = types.KeyboardButton('–û—Ç–º–µ–Ω–∏—Ç—å')
        back = types.KeyboardButton('–ù–∞–∑–∞–¥')
        markup.add(item1,item2,item3,item4,item5,item6,back)
        bot.send_message(message.chat.id, '–ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ?', reply_markup=markup)
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='15_–º–∏–Ω')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–•–æ—Ä–æ—à–æ, –≤—ã–∫–ª—é—á—É —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç...')
        os.system("shutdown -s -t 900")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='30_–º–∏–Ω')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–•–æ—Ä–æ—à–æ, –≤—ã–∫–ª—é—á—É —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç...')
        os.system("shutdown -s -t 1800")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='45_–º–∏–Ω')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–•–æ—Ä–æ—à–æ, –≤—ã–∫–ª—é—á—É —á–µ—Ä–µ–∑ 45 –º–∏–Ω—É—Ç...')
        os.system("shutdown -s -t 2700")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='60_–º–∏–Ω')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–•–æ—Ä–æ—à–æ, –≤—ã–∫–ª—é—á—É —á–µ—Ä–µ–∑ 60 –º–∏–Ω—É—Ç...')
        os.system("shutdown -s -t 3600")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='2_—á–∞—Å–∞')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–•–æ—Ä–æ—à–æ, –≤—ã–∫–ª—é—á—É —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞...')
        os.system("shutdown -s -t 7200")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')

@bot.message_handler(regexp='–û—Ç–º–µ–Ω–∏—Ç—å')
def send_welcome(message):
    if is_allowed_user(message):
        bot.send_message(message.chat.id, '–û—Ç–∫–ª—é—á–∞—é —Ç–∞–π–º–µ—Ä.')
        os.system("shutdown /a")
        
    else:
        bot.send_message(message.chat.id, '–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –±–æ—Ç—É')


bot.infinity_polling()